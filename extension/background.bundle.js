/*! For license information please see background.bundle.js.LICENSE.txt */
(()=>{function e(){var n,r,o="function"==typeof Symbol?Symbol:{},a=o.iterator||"@@iterator",c=o.toStringTag||"@@toStringTag";function i(e,o,a,c){var i=o&&o.prototype instanceof u?o:u,l=Object.create(i.prototype);return t(l,"_invoke",function(e,t,o){var a,c,i,u=0,l=o||[],f=!1,p={p:0,n:0,v:n,a:d,f:d.bind(n,4),d:function(e,t){return a=e,c=0,i=n,p.n=t,s}};function d(e,t){for(c=e,i=t,r=0;!f&&u&&!o&&r<l.length;r++){var o,a=l[r],d=p.p,h=a[2];e>3?(o=h===t)&&(i=a[(c=a[4])?5:(c=3,3)],a[4]=a[5]=n):a[0]<=d&&((o=e<2&&d<a[1])?(c=0,p.v=t,p.n=a[1]):d<h&&(o=e<3||a[0]>t||t>h)&&(a[4]=e,a[5]=t,p.n=h,c=0))}if(o||e>1)return s;throw f=!0,t}return function(o,l,h){if(u>1)throw TypeError("Generator is already running");for(f&&1===l&&d(l,h),c=l,i=h;(r=c<2?n:i)||!f;){a||(c?c<3?(c>1&&(p.n=-1),d(c,i)):p.n=i:p.v=i);try{if(u=2,a){if(c||(o="next"),r=a[o]){if(!(r=r.call(a,i)))throw TypeError("iterator result is not an object");if(!r.done)return r;i=r.value,c<2&&(c=0)}else 1===c&&(r=a.return)&&r.call(a),c<2&&(i=TypeError("The iterator does not provide a '"+o+"' method"),c=1);a=n}else if((r=(f=p.n<0)?i:e.call(t,p))!==s)break}catch(e){a=n,c=1,i=e}finally{u=1}}return{value:r,done:f}}}(e,a,c),!0),l}var s={};function u(){}function l(){}function f(){}r=Object.getPrototypeOf;var p=[][a]?r(r([][a]())):(t(r={},a,function(){return this}),r),d=f.prototype=u.prototype=Object.create(p);function h(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,f):(e.__proto__=f,t(e,c,"GeneratorFunction")),e.prototype=Object.create(d),e}return l.prototype=f,t(d,"constructor",f),t(f,"constructor",l),l.displayName="GeneratorFunction",t(f,c,"GeneratorFunction"),t(d),t(d,c,"Generator"),t(d,a,function(){return this}),t(d,"toString",function(){return"[object Generator]"}),(e=function(){return{w:i,m:h}})()}function t(e,n,r,o){var a=Object.defineProperty;try{a({},"",{})}catch(e){a=0}t=function(e,n,r,o){function c(n,r){t(e,n,function(e){return this._invoke(n,r,e)})}n?a?a(e,n,{value:r,enumerable:!o,configurable:!o,writable:!o}):e[n]=r:(c("next",0),c("throw",1),c("return",2))},t(e,n,r,o)}function n(e,t,n,r,o,a,c){try{var i=e[a](c),s=i.value}catch(e){return void n(e)}i.done?t(s):Promise.resolve(s).then(r,o)}function r(e){return function(){var t=this,r=arguments;return new Promise(function(o,a){var c=e.apply(t,r);function i(e){n(c,o,a,i,s,"next",e)}function s(e){n(c,o,a,i,s,"throw",e)}i(void 0)})}}console.log("Web3 Guardian background script loaded");var o=new Map;function a(){return(a=r(e().m(function t(n,r){var a,c,s,u,l,f;return e().w(function(e){for(;;)switch(e.p=e.n){case 0:if(e.p=0,a=i(n),!(c=o.get(a))){e.n=1;break}return console.log("Using cached analysis result"),r(c),e.a(2);case 1:return e.n=2,fetch("".concat("http://localhost:8000","/api/analyze"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({tx_data:n,network:"ethereum",user_address:n.from})});case 2:if((s=e.v).ok){e.n=3;break}throw new Error("Backend error: ".concat(s.status));case 3:return e.n=4,s.json();case 4:u=e.v,o.size>=100&&(l=o.keys().next().value,o.delete(l)),o.set(a,u),setTimeout(function(){o.delete(a)},3e5),r(u),e.n=6;break;case 5:e.p=5,f=e.v,console.error("Error analyzing transaction:",f),r({success:!1,error:f.message,riskLevel:"unknown",recommendations:[]});case 6:return e.a(2)}},t,null,[[0,5]])}))).apply(this,arguments)}function c(){return(c=r(e().m(function t(n,r){var o,a;return e().w(function(e){for(;;)switch(e.n){case 0:try{o="tx-".concat(Date.now()),chrome.notifications.create(o,{type:"basic",iconUrl:chrome.runtime.getURL("assets/icon128.png"),title:"Web3 Transaction Detected",message:"A Web3 transaction is being processed. Click to review.",priority:2,requireInteraction:!0}),a=function(e){e===o&&(chrome.windows.create({url:chrome.runtime.getURL("popup.html")+"?tx=".concat(encodeURIComponent(JSON.stringify(n))),type:"popup",width:400,height:600}),chrome.notifications.clear(o))},chrome.notifications.onClicked.addListener(a),setTimeout(function(){chrome.notifications.clear(o),chrome.notifications.onClicked.removeListener(a),r({shouldProceed:!0})},3e3)}catch(e){console.error("Error handling Web3 transaction:",e),r({shouldProceed:!1,error:e.message})}case 1:return e.a(2)}},t)}))).apply(this,arguments)}function i(e){var t=e.from,n=e.to,r=e.value,o=e.data,a=e.gas,c=e.gasPrice;return"".concat(t,"-").concat(n,"-").concat(r,"-").concat(o,"-").concat(a,"-").concat(c)}chrome.runtime.onMessage.addListener(function(e,t,n){switch(console.log("Background received message:",e.type),e.type){case"ANALYZE_TRANSACTION":return function(e,t){a.apply(this,arguments)}(e.data,n),!0;case"WEB3_TRANSACTION":return function(e,t){c.apply(this,arguments)}(e.data,n),!0;default:console.warn("Unknown message type:",e.type),n({success:!1,error:"Unknown message type"})}}),chrome.runtime.onInstalled.addListener(function(e){"install"===e.reason?(console.log("Web3 Guardian installed"),chrome.tabs.create({url:chrome.runtime.getURL("onboarding.html")})):"update"===e.reason&&console.log("Web3 Guardian updated to version",chrome.runtime.getManifest().version)})})();
//# sourceMappingURL=background.bundle.js.map